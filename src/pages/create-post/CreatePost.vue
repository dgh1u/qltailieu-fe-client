<template>
  <ProfileLayout>
    <div class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-6">
      <div class="max-w-5xl mx-auto">
        <!-- Header Section -->
        <div
          class="text-center mb-8"
          data-aos="fade-down"
          data-aos-duration="600"
        >
      
          <h1 class="text-4xl font-bold text-gray-800 mb-2">
            ƒêƒÉng t·∫£i t√†i li·ªáu
          </h1>
          <p class="text-gray-600 text-lg">
            Chia s·∫ª t√†i li·ªáu h·ªçc t·∫≠p v·ªõi c·ªông ƒë·ªìng VNUA
          </p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Main Content - Left Side -->
          <div class="lg:col-span-2 space-y-6">
            <!-- Document Category Card -->
            <div
              class="bg-white rounded-3xl shadow-xl p-8"
              data-aos="fade-up"
              data-aos-duration="800"
            >
              <div class="flex items-center mb-6">
                <div
                  class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-4"
                >
                  <svg
                    class="w-6 h-6 text-blue-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
                    ></path>
                  </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">
                  Ph√¢n lo·∫°i t√†i li·ªáu
                </h2>
              </div>

              <div
                v-if="formData.criteria.motel === 'TAI_LIEU'"
                class="space-y-6"
              >
                <div>
                  <label
                    class="flex items-center text-sm font-semibold text-gray-700 mb-3"
                  >
                    <svg
                      class="w-4 h-4 mr-2 text-gray-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                      ></path>
                    </svg>
                    Lo·∫°i t√†i li·ªáu <span class="text-red-500">*</span>
                  </label>
                  <a-select
                    v-model:value="formData.criteria.secondMotel"
                    placeholder="Ch·ªçn lo·∫°i t√†i li·ªáu"
                    class="w-full"
                    size="large"
                  >
                    <a-select-option value="Gi√°o tr√¨nh"
                      >üìö Gi√°o tr√¨nh</a-select-option
                    >
                    <a-select-option value="S√°ch tham kh·∫£o"
                      >üìñ S√°ch tham kh·∫£o</a-select-option
                    >
                    <a-select-option value="Kh√≥a lu·∫≠n t·ªët nghi·ªáp"
                      >üéì Kh√≥a lu·∫≠n t·ªët nghi·ªáp</a-select-option
                    >
                    <a-select-option value="B√°o c√°o th·ª±c t·∫≠p"
                      >üìù B√°o c√°o th·ª±c t·∫≠p</a-select-option
                    >
                    <a-select-option value="Nghi√™n c·ª©u khoa h·ªçc"
                      >üî¨ Nghi√™n c·ª©u khoa h·ªçc</a-select-option
                    >
                    <a-select-option value="B√†i b√°o khoa h·ªçc"
                      >üìÑ B√†i b√°o khoa h·ªçc</a-select-option
                    >
                    <a-select-option value="T√†i li·ªáu kh√°c"
                      >üìã T√†i li·ªáu kh√°c</a-select-option
                    >
                  </a-select>
                </div>

                <div>
                  <label
                    class="flex items-center text-sm font-semibold text-gray-700 mb-3"
                  >
                    <svg
                      class="w-4 h-4 mr-2 text-gray-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"
                      ></path>
                    </svg>
                    Chuy√™n ng√†nh <span class="text-red-500">*</span>
                  </label>
                  <a-select
                    v-model:value="formData.criteria.major"
                    placeholder="Ch·ªçn chuy√™n ng√†nh"
                    class="w-full"
                    size="large"
                  >
                    <a-select-option value="Th√∫ y">üêæ Th√∫ y</a-select-option>
                    <a-select-option value="ChƒÉn nu√¥i - Th·ªßy s·∫£n"
                      >üêÑ ChƒÉn nu√¥i - Th·ªßy s·∫£n</a-select-option
                    >
                    <a-select-option value="C∆° ƒëi·ªán"
                      >‚öôÔ∏è C∆° ƒëi·ªán</a-select-option
                    >
                    <a-select-option value="C√¥ng ngh·ªá th√¥ng tin"
                      >üíª C√¥ng ngh·ªá th√¥ng tin</a-select-option
                    >
                    <a-select-option value="Kinh t·∫ø"
                      >üí∞ Kinh t·∫ø</a-select-option
                    >
                    <a-select-option value="C√¥ng ngh·ªá sinh h·ªçc"
                      >üß¨ C√¥ng ngh·ªá sinh h·ªçc</a-select-option
                    >
                    <a-select-option value="C√¥ng ngh·ªá th·ª±c ph·∫©m"
                      >üçé C√¥ng ngh·ªá th·ª±c ph·∫©m</a-select-option
                    >
                    <a-select-option value="N√¥ng h·ªçc"
                      >üå± N√¥ng h·ªçc</a-select-option
                    >
                    <a-select-option value="Khoa h·ªçc m√¥i tr∆∞·ªùng"
                      >üåç Khoa h·ªçc m√¥i tr∆∞·ªùng</a-select-option
                    >
                    <a-select-option value="X√£ h·ªôi h·ªçc"
                      >üë• X√£ h·ªôi h·ªçc</a-select-option
                    >
                    <a-select-option value="Ng√¥n ng·ªØ"
                      >üåê Ng√¥n ng·ªØ</a-select-option
                    >
                    <a-select-option value="Du l·ªãch"
                      >‚úàÔ∏è Du l·ªãch</a-select-option
                    >
                    <a-select-option value="S∆∞ ph·∫°m"
                      >üë®‚Äçüè´ S∆∞ ph·∫°m</a-select-option
                    >
                    <a-select-option value="Qu·∫£n l√Ω ƒë·∫•t ƒëai"
                      >üó∫Ô∏è Qu·∫£n l√Ω ƒë·∫•t ƒëai</a-select-option
                    >
                  </a-select>
                </div>
              </div>
            </div>

            <!-- Document Information Card -->
            <div
              class="bg-white rounded-3xl shadow-xl p-8"
              data-aos="fade-up"
              data-aos-duration="900"
            >
              <div class="flex items-center mb-6">
                <div
                  class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-4"
                >
                  <svg
                    class="w-6 h-6 text-green-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
                    ></path>
                  </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">
                  Th√¥ng tin m√¥ t·∫£
                </h2>
              </div>

              <div class="space-y-6">
                <div>
                  <label
                    class="flex items-center text-sm font-semibold text-gray-700 mb-3"
                  >
                    <svg
                      class="w-4 h-4 mr-2 text-gray-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
                      ></path>
                    </svg>
                    Ti√™u ƒë·ªÅ <span class="text-red-500">*</span>
                  </label>
                  <input
                    v-model="formData.title"
                    type="text"
                    placeholder="Nh·∫≠p ti√™u ƒë·ªÅ t√†i li·ªáu..."
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all duration-300 text-gray-700"
                  />
                </div>

                <div>
                  <label
                    class="flex items-center text-sm font-semibold text-gray-700 mb-3"
                  >
                    <svg
                      class="w-4 h-4 mr-2 text-gray-500"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6h16M4 12h16M4 18h7"
                      ></path>
                    </svg>
                    N·ªôi dung m√¥ t·∫£ <span class="text-red-500">*</span>
                  </label>
                  <textarea
                    v-model="formData.content"
                    placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ t√†i li·ªáu, n·ªôi dung, t√°c gi·∫£, nƒÉm xu·∫•t b·∫£n..."
                    rows="5"
                    class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all duration-300 text-gray-700 resize-none"
                  />
                </div>
              </div>
            </div>

            <!-- Document Upload Card -->
            <div
              class="bg-white rounded-3xl shadow-xl p-8"
              data-aos="fade-up"
              data-aos-duration="1000"
            >
              <div class="flex items-center mb-6">
                <div
                  class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-4"
                >
                  <svg
                    class="w-6 h-6 text-purple-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    ></path>
                  </svg>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">
                  T√†i li·ªáu ƒë√≠nh k√®m
                </h2>
              </div>

              <div class="mb-6">
                <label
                  class="group flex flex-col items-center justify-center w-full h-40 px-4 transition-all bg-gradient-to-br from-blue-50 to-purple-50 border-2 border-dashed border-blue-300 rounded-2xl cursor-pointer hover:from-blue-100 hover:to-purple-100 hover:border-blue-400 focus:outline-none"
                  @dragover="handleDragOver"
                  @drop="handleDrop"
                >
                  <div class="flex flex-col items-center space-y-3">
                    <div
                      class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center group-hover:bg-blue-200 transition-colors"
                    >
                      <svg
                        class="w-6 h-6 text-blue-600"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                        ></path>
                      </svg>
                    </div>
                    <div class="text-center">
                      <span class="font-semibold text-gray-700 text-lg"
                        >T·∫£i l√™n t√†i li·ªáu</span
                      >
                      <p class="text-sm text-gray-500 mt-1">
                        K√©o th·∫£ ho·∫∑c click ƒë·ªÉ ch·ªçn file
                      </p>
                    </div>
                  </div>
                  <input
                    type="file"
                    name="documents"
                    class="hidden"
                    multiple
                    accept=".pdf,.docx,.ppt,.pptx,.xlsx,.zip"
                    @change="handleDocumentChange"
                  />
                </label>
              </div>

              <!-- Document List -->
              <div v-if="selectedDocuments.length > 0" class="space-y-3 mb-6">
                <div
                  v-for="(doc, index) in selectedDocuments"
                  :key="index"
                  class="group flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl border border-gray-200 hover:shadow-md transition-all duration-300"
                >
                  <div class="flex items-center space-x-4">
                    <div
                      class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center"
                    >
                      <svg
                        class="w-6 h-6 text-blue-600"
                        fill="currentColor"
                        viewBox="0 0 20 20"
                      >
                        <path d="M4 18h12V6l-4-4H4v16z" />
                      </svg>
                    </div>
                    <div>
                      <span class="font-semibold text-gray-800 text-sm">{{
                        doc.name
                      }}</span>
                      <p class="text-xs text-gray-500">
                        {{ formatFileSize(doc.size) }}
                      </p>
                    </div>
                  </div>
                  <button
                    @click="removeDocument(index)"
                    class="opacity-0 group-hover:opacity-100 p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-all duration-300"
                  >
                    <Trash2 class="w-4 h-4" />
                  </button>
                </div>
              </div>

              <div class="text-center">
                <p class="text-sm text-gray-500">
                  <span class="font-semibold">H·ªó tr·ª£:</span> PDF, Word (.docx),
                  PowerPoint (.ppt, .pptx), Excel (.xlsx), ZIP
                </p>
                <p class="text-xs text-gray-400 mt-1">T·ªëi ƒëa 50MB m·ªói file</p>
              </div>
            </div>
          </div>

          <!-- Right Sidebar -->
          <div class="lg:col-span-1 space-y-6">
             <!-- H√¨nh ·∫£nh -->
      <div class="block bg-white p-4 rounded-xl">
        <div class="py-2 pb-6">
          <span class="font-bold text-base">H√¨nh ·∫£nh</span>
        </div>

        <!-- Single Image Upload Box -->
        <div class="mb-4">
          <div v-if="!file" class="relative border-2 border-dashed border-sky-500 rounded-lg h-40 flex flex-col justify-center items-center cursor-pointer hover:bg-sky-50 transition">
            <FolderUp class="w-10 h-10 text-sky-500" />
            <span class="mt-2 text-gray-500 text-sm text-center">
              T·∫£i ·∫£nh t·ª´ thi·∫øt b·ªã
            </span>
            <input
              type="file"
              accept="image/*"
              @change="handleFileChange"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
            />
          </div>
          <div v-else class="relative h-40 rounded-lg overflow-hidden">
            <img
              :src="file.preview"
              alt="preview"
              class="w-full h-full object-cover"
            />
          <button
            @click="removeImage"
            class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex items-center space-x-1 px-2 py-1 bg-white bg-opacity-70 rounded-md text-red-500 hover:text-red-600"
          >
            <Trash2 class="w-4 h-4" />
            <span class="text-xs">X√≥a</span>
          </button>
          </div>
        </div>

        <small class="text-gray-500">
          Dung l∆∞·ª£ng ·∫£nh t·ªëi ƒëa 10MB
        </small>
      </div>
  
     

            <!-- Upload Guidelines -->
            <div
              class="bg-gradient-to-br from-green-50 to-blue-50 rounded-3xl p-6 border border-green-200"
              data-aos="fade-left"
              data-aos-duration="900"
            >
              <div class="flex items-center mb-4">
                <div
                  class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mr-3"
                >
                  <svg
                    class="w-4 h-4 text-green-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                </div>
                <h3 class="text-lg font-bold text-gray-800">H∆∞·ªõng d·∫´n</h3>
              </div>

              <ul class="space-y-2 text-sm text-gray-600">
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">‚Ä¢</span>
                  <span>Ch·ªçn ƒë√∫ng lo·∫°i v√† chuy√™n ng√†nh t√†i li·ªáu</span>
                </li>
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">‚Ä¢</span>
                  <span>Ti√™u ƒë·ªÅ ng·∫Øn g·ªçn, s√∫c t√≠ch</span>
                </li>
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">‚Ä¢</span>
                  <span>M√¥ t·∫£ chi ti·∫øt n·ªôi dung t√†i li·ªáu</span>
                </li>
                <li class="flex items-start">
                  <span class="text-green-500 mr-2">‚Ä¢</span>
                  <span>ƒê√≠nh k√®m file t√†i li·ªáu g·ªëc</span>
                </li>
              </ul>
            </div>

            <!-- Submit Button -->
            <div
              class="sticky top-6"
              data-aos="fade-left"
              data-aos-duration="1000"
            >
              <button
                @click="handleCreatePost"
                :disabled="loading"
                class="w-full bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 text-white font-bold py-4 px-6 rounded-2xl transition-all duration-300 flex items-center justify-center space-x-3 shadow-xl hover:shadow-2xl transform hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
              >
                <div
                  v-if="loading"
                  class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"
                ></div>
                <svg
                  v-else
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                  ></path>
                </svg>
                <span>{{ loading ? "ƒêang t·∫°o..." : "ƒêƒÉng t√†i li·ªáu" }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ProfileLayout>
</template>

<script setup>
// Import c√°c th∆∞ vi·ªán Vue c·∫ßn thi·∫øt
import { ref, reactive } from "vue";

// Import c√°c API service
import { createPost } from "@/apis/postService.js";
import { uploadMultipleImages } from "@/apis/imageService.js";
import { uploadDocument } from "@/apis/documentService.js";

// Import c√°c component c·ªßa Ant Design Vue
import { Select, message, Modal } from "ant-design-vue";
const { confirm } = Modal;
const { Option: ASelectOption } = Select;

// Import icons
import { FolderUp, Trash2 } from "lucide-vue-next";

// Import layout
import ProfileLayout from "@/layouts/ProfileLayout.vue";

const ASelect = Select;
const ASelectOptionComponent = ASelectOption;

// Bi·∫øn l∆∞u tr·ªØ ·∫£nh ƒë·∫°i di·ªán
const file = ref(null);

// Danh s√°ch t√†i li·ªáu ƒë√≠nh k√®m
const selectedDocuments = ref([]);

// H√†m x·ª≠ l√Ω khi ng∆∞·ªùi d√πng ch·ªçn file t√†i li·ªáu
function handleDocumentChange(event) {
  const files = Array.from(event.target.files);
  processFiles(files);
  event.target.value = "";
}

// H√†m ki·ªÉm tra v√† x·ª≠ l√Ω c√°c file ƒë∆∞·ª£c ch·ªçn
function processFiles(files) {
  const allowedTypes = [".pdf", ".docx", ".ppt", ".pptx", ".xlsx", ".zip"];
  const validFiles = files.filter((file) => {
    const fileName = file.name.toLowerCase();
    return allowedTypes.some((type) => fileName.endsWith(type));
  });

  if (validFiles.length !== files.length) {
    message.error("Ch·ªâ cho ph√©p upload file PDF, Word, PowerPoint");
    return;
  }

  selectedDocuments.value = [...selectedDocuments.value, ...validFiles];
}

// H√†m x·ª≠ l√Ω khi k√©o file v√†o v√πng upload
function handleDragOver(event) {
  event.preventDefault();
}

// H√†m x·ª≠ l√Ω khi th·∫£ file v√†o v√πng upload
function handleDrop(event) {
  event.preventDefault();
  const files = Array.from(event.dataTransfer.files);
  processFiles(files);
}

// H√†m x√≥a m·ªôt t√†i li·ªáu kh·ªèi danh s√°ch
function removeDocument(index) {
  selectedDocuments.value.splice(index, 1);
}

// H√†m ƒë·ªãnh d·∫°ng k√≠ch th∆∞·ªõc file
function formatFileSize(bytes) {
  if (bytes === 0) return "0 Bytes";
  const k = 1024;
  const sizes = ["Bytes", "KB", "MB", "GB"];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
}

// D·ªØ li·ªáu form t·∫°o b√†i ƒëƒÉng t√†i li·ªáu
const formData = reactive({
  title: "",
  content: "",
  criteria: {
    motel: "TAI_LIEU",
    
    secondMotel: "",

    major: "",
    referenceUrl: "",
  },
});

// Tr·∫°ng th√°i loading khi ƒëang x·ª≠ l√Ω
const loading = ref(false);

// H√†m x·ª≠ l√Ω khi ch·ªçn ·∫£nh ƒë·∫°i di·ªán
const handleFileChange = (e) => {
  const selectedFile = e.target.files[0];

  if (selectedFile) {
    // Ki·ªÉm tra dung l∆∞·ª£ng file (t·ªëi ƒëa 10MB)
    if (selectedFile.size > 10 * 1024 * 1024) {
      message.error("Dung l∆∞·ª£ng ·∫£nh kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° 10MB");
      e.target.value = null;
      return;
    }

    file.value = {
      file: selectedFile,
      preview: URL.createObjectURL(selectedFile),
    };
  }
  e.target.value = null;
};

// H√†m x√≥a ·∫£nh ƒë·∫°i di·ªán
const removeImage = () => {
  if (file.value) {
    URL.revokeObjectURL(file.value.preview);
    file.value = null;
  }
};

// H√†m x·ª≠ l√Ω t·∫°o b√†i ƒëƒÉng t√†i li·ªáu
const handleCreatePost = () => {
  // Ki·ªÉm tra ti√™u ƒë·ªÅ
  if (!formData.title.trim()) {
    message.error("Ti√™u ƒë·ªÅ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng");
    return;
  }
  if (formData.title.trim().length < 10 || formData.title.trim().length > 100) {
    message.error("Ti√™u ƒë·ªÅ ph·∫£i t·ª´ 10 ƒë·∫øn 100 k√Ω t·ª±");
    return;
  }

  // Ki·ªÉm tra n·ªôi dung m√¥ t·∫£
  if (!formData.content.trim()) {
    message.error("N·ªôi dung m√¥ t·∫£ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng");
    return;
  }
  if (formData.content.trim().length < 50 || formData.content.trim().length > 500) {
    message.error("N·ªôi dung m√¥ t·∫£ ph·∫£i t·ª´ 50 ƒë·∫øn 500 k√Ω t·ª±");
    return;
  }

  // Ki·ªÉm tra lo·∫°i t√†i li·ªáu
  if (!formData.criteria.secondMotel) {
    message.error("Vui l√≤ng ch·ªçn lo·∫°i t√†i li·ªáu");
    return;
  }

  // Ki·ªÉm tra chuy√™n ng√†nh
  if (!formData.criteria.major) {
    message.error("Vui l√≤ng ch·ªçn chuy√™n ng√†nh");
    return;
  }

  // Hi·ªÉn th·ªã h·ªôp tho·∫°i x√°c nh·∫≠n tr∆∞·ªõc khi ƒëƒÉng 
  confirm({
    title: "X√°c nh·∫≠n ƒëƒÉng b√†i",
    content: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng t√†i li·ªáu n√†y kh√¥ng?",
    async onOk() {
      loading.value = true;
      try {
        // T·∫°o b√†i ƒëƒÉng
        const { data: post } = await createPost(formData);
        const postId = post.id;

        // Upload ·∫£nh ƒë·∫°i di·ªán n·∫øu c√≥
        if (file.value) {
          await uploadMultipleImages(postId, [file.value.file]);
        }

        // Upload c√°c t√†i li·ªáu ƒë√≠nh k√®m
        if (selectedDocuments.value.length > 0) {
          for (const doc of selectedDocuments.value) {
            await uploadDocument(postId, doc);
          }
        }

        message.success("ƒêƒÉng t√†i li·ªáu th√†nh c√¥ng!");
        resetForm();
        file.value = null;
      } catch (error) {
        // X·ª≠ l√Ω l·ªói khi ƒëƒÉng t√†i li·ªáu
        const errorMessage = error.message;
        if (errorMessage.includes("Sai")) {
          message.error("Kh√¥ng th·ªÉ ƒëƒÉng t√†i li·ªáu!");
        } else {
          message.error("ƒê√£ c√≥ l·ªói x·∫£y ra");
        }
      } finally {
        loading.value = false;
      }
    },
    onCancel() {
      message.info("ƒê√£ h·ªßy ƒëƒÉng t√†i li·ªáu");
    },
  });
};

// H√†m reset form v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu
const resetForm = () => {
  Object.assign(formData, {
    title: "",
    content: "",
    criteria: {
      motel: "TAI_LIEU",
      price: "",
      acreage: "",
      electricPrice: "",
      waterPrice: "",
      gender: "",
      address: "",
      idDistrict: "",
      interior: "",
      airConditioner: "",
      heater: "",
      internet: "",
      toilet: "",
      time: "",
      parking: "",
      security: "",
      owner: "",
      kitchen: "",
      secondMotel: "",
      openHours: "",
      delivery: "",
      dineIn: "",
      takeAway: "",
      bigSpace: "",
      linkShopeeFood: "",
      major: "",
      referenceUrl: "",
    },
  });
};
</script>

<style scoped>
.submit-btn:hover {
  background-color: #2980b9;
}
.loader {
  border: 2px solid #f3f3f3; /* Light grey */
  border-top: 2px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 16px;
  height: 16px;
  animation: spin 2s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
</style>
